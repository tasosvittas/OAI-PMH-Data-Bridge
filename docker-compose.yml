services:
  oai-pmh:
    build:
      context: .
      dockerfile: Dockerfile.php
    container_name: oai-pmh2-php
    volumes:
      - ./config:/var/www/html/config   
      - ./data:/var/www/html/data        
      - ./var:/var/www/html/var          
    environment:
      - APACHE_DOCUMENT_ROOT=/var/www/html/public
    networks:
      - oai-network
    restart: unless-stopped

  bridge:
    build:
      context: ./bridge
      dockerfile: Dockerfile
    container_name: oai-pmh2-bridge
    ports:
      - "5000:5000"
    volumes:
      - ./bridge:/app
      - ./temp:/app/temp
      - ./:/oai-pmh2:ro
    environment:
      - OAI_PMH_CLI_PATH=/oai-pmh2/bin/cli
      - OAI_PMH_BASE_URL=http://oai-pmh/
      - FLASK_HOST=0.0.0.0
      - FLASK_PORT=5000
    networks:
      - oai-network
    depends_on:
      - oai-pmh
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    container_name: oai-pmh2-nginx
    ports:
      - "80:80"
    volumes:
      - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - oai-network
    depends_on:
      - oai-pmh
      - bridge
    restart: unless-stopped

networks:
  oai-network:
    driver: bridge

